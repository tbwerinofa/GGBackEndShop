version: '3.4'

networks:
  backend:
  frontend:



services:
    productdb:
        container_name: product-db
        image: mcr.microsoft.com/mssql/server:2019-latest
        environment:
        - ACCEPT_EULA=Y
        - SA_PASSWORD=P@ssw0rd!
        networks:
          - backend
        ports:
          - 18001:1433
    productwebapi:
        container_name: product-api
        image: ${DOCKER_REGISTRY-}productwebapi
        build:
          context: .
          dockerfile: ProductWebAPI/Dockerfile
        networks:
          - backend
        environment:
          - DB_HOST=productdb
          - DB_NAME=ProductShopDB
          - DB_SA_PASSWORD=P@ssw0rd!

    apigateway:
        container_name:  backend-shop-api-gateway
        image: ${DOCKER_REGISTRY-}apigateway
        build:
          context: .
          dockerfile: ApiGateway/Dockerfile
        ports:
          - 8003:80
        networks:
           - backend
           - frontend

    shopui:
        container_name: shop-ui
        image: ${DOCKER_REGISTRY-}shopui
        build:
          context: .
          dockerfile: ShopUI/Dockerfile
        ports:
         - 8002:80
        networks:
           - frontend
    authenticationapi:
        container_name: authentication-api
        image: ${DOCKER_REGISTRY-}authenticationapi
        build:
          context: .
          dockerfile: AuthenticationApi/Dockerfile
        depends_on: 
          - productdb
        environment:
          - DB_HOST=productdb
          - DB_NAME=UserDB
          - DB_SA_PASSWORD=P@ssw0rd!
        networks:
           - backend

